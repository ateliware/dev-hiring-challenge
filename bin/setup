#!/bin/bash

check_docker_presence() {
  if [ -x "$(command -v docker)" ]; then
    echo "âœ… Yippee! Docker is present"
  else
    echo "ðŸ›‘ Oh-oh! Docker is not present. Please install before proceeding."
    exit 1
  fi
}

check_docker_compose_presence() {
  if [ -x "$(command -v docker-compose)" ]; then
    echo "âœ… Hooray! Docker Compose is present"
  else
    echo "ðŸ›‘ Shame! Docker Compose is not present. Please install before proceeding."
    exit 1
  fi
}

build_project() {
  if docker-compose build web; then
    echo "âœ… Yay! Built web image successfully"
  else
    echo "ðŸ›‘ Oops! Error while building web image"
    exit 1
  fi
}

create_database() {
  if docker-compose run web /bin/ash -c "sleep 5 && MIX_ENV=dev mix do ecto.create, ecto.migrate"; then
    echo "âœ… Yay! Database created successfully"
  else
    echo "ðŸ›‘ Oops! Error while creating database"
    exit 1
  fi
}


echo "ðŸ¤” Verifing Docker presence..."
check_docker_presence

echo "ðŸ¤” Verifing Docker Compose presence..."
check_docker_compose_presence

echo "ðŸ¤” Building Docker image and project dependencies..."
build_project

echo "ðŸ¤” Creating PostgreSQL Database..."
create_database

